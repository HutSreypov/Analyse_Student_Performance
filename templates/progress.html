{% extends "base.html" %}

{% block title %}Student Progress{% endblock %}

{% block content %}
<h2>Progress for {{ student.name }}</h2>

<!-- Chart Container -->
<canvas id="progressChart" width="400" height="200"></canvas>

<table class="table table-bordered mt-4">
    <thead>
        <tr>
            <th>Subject</th>
            <th>Midterm</th>
            <th>Final</th>
            <th>Assignment</th>
            <th>Total</th>
            <th>Grade</th>
        </tr>
    </thead>
    <tbody>
        {% for score in scores %}
        <tr>
            <td>{{ score.subject_name }}</td>
            <td>{{ score.midterm }}</td>
            <td>{{ score.final }}</td>
            <td>{{ score.assignment }}</td>
            <td>{{ score.total }}</td>
            <td>{{ score.grade }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<a href="{{ url_for('student_bp.list_students') }}" class="btn btn-secondary">Back to Students</a>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('progressChart');
    
    // Get the scores data from the template
    const scores = JSON.parse('{{ scores|tojson|safe }}');
    
    if (scores && scores.length > 0) {
        // Extract subject names for labels
        const subjects = [];
        const midtermScores = [];
        const finalScores = [];
        const assignmentScores = [];
        const totalScores = [];
        
        scores.forEach(score => {
            subjects.push(score.subject_name || score.subject || 'Unknown');
            midtermScores.push(score.midterm || 0);
            finalScores.push(score.final || 0);
            assignmentScores.push(score.assignment || 0);
            totalScores.push(score.total || 0);
        });
        
        const progressChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: subjects,
                datasets: [
                    {
                        label: 'Midterm',
                        data: midtermScores,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)'
                    },
                    {
                        label: 'Final',
                        data: finalScores,
                        backgroundColor: 'rgba(255, 99, 132, 0.6)'
                    },
                    {
                        label: 'Assignment',
                        data: assignmentScores,
                        backgroundColor: 'rgba(255, 206, 86, 0.6)'
                    },
                    {
                        label: 'Total',
                        data: totalScores,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)'
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { 
                        display: true, 
                        text: 'Student Progress Chart',
                        font: { size: 16 }
                    }
                },
                scales: {
                    y: { 
                        beginAtZero: true, 
                        max: 100,
                        title: {
                            display: true,
                            text: 'Scores'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Subjects'
                        }
                    }
                }
            }
        });
    } else {
        // Display a message if no data is available
        ctx.parentNode.innerHTML = '<p class="text-center text-muted">No progress data available for this student.</p>';
    }
});
</script>

{% endblock %}
