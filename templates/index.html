{% extends "base.html" %}
{% block title %}Dashboard - Student Performance Analytics{% endblock %}

{% block styles %}
<link href="https://cdn.jsdelivr.net/npm/apexcharts@3.35.0/dist/apexcharts.min.css" rel="stylesheet">
<style>
  :root {
    --primary-color: #5e72e4;
    --secondary-color: #2dce89;
    --info-color: #11cdef;
  }
  
  body {
    background-color: #f5f7fb;
  }
  
  body {
    background-color: #f8f9fe;
    color: #525f7f;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    line-height: 1.5;
  }
  
  .welcome-section {
    background: linear-gradient(87deg, #5e72e4 0, #825ee4 100%);
    color: white;
    padding: 2.5rem;
    border-radius: var(--border-radius);
    margin-bottom: 2rem;
    box-shadow: var(--box-shadow);
    position: relative;
    overflow: hidden;
    background-size: 150%;
    background-position: 100% 50%;
    transition: all 0.5s ease;
  }
  
  .welcome-section:hover {
    background-position: 0% 50%;
  }
  
  .welcome-section::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50px;
    width: 300px;
    height: 300px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    z-index: 0;
  }
  
  /* Stat Cards */
  .stat-card {
    background: white;
    border-radius: var(--border-radius);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: var(--box-shadow);
    transition: var(--transition);
    border: 0;
    height: 100%;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  
  .stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.1);
  }
  
  .stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--primary);
  }
  
  .stat-card.primary::before { background: var(--primary); }
  .stat-card.success::before { background: var(--success); }
  .stat-card.info::before { background: var(--info); }
  .stat-card.warning::before { background: var(--warning); }
  
  .stat-card .icon-wrapper {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
  }

  .stat-card.primary .icon-wrapper { background: rgba(67, 97, 238, 0.1); color: var(--primary); }
  .stat-card.success .icon-wrapper { background: rgba(40, 167, 69, 0.1); color: var(--success); }
  .stat-card.info .icon-wrapper { background: rgba(23, 162, 184, 0.1); color: var(--info); }
  .stat-card.warning .icon-wrapper { background: rgba(255, 193, 7, 0.1); color: var(--warning); }

  .stat-card i {
    font-size: 1.75rem;
  }

  .stat-card .stat-value {
    font-size: 1.75rem;
    font-weight: 700;
    margin: 0.5rem 0;
    color: var(--dark);
  }

  .stat-card .stat-label {
    color: var(--gray);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .stat-card .stat-change {
    display: flex;
    align-items: center;
    font-size: 0.85rem;
    margin-top: 0.5rem;
  }

  .stat-card .stat-change.positive { color: var(--success); }
  .stat-card .stat-change.negative { color: var(--danger); }

  .stat-card .stat-change i {
    font-size: 1rem;
    margin-right: 0.25rem;
  }

  /* Quick Actions */
  .quick-actions .card {
    border: none;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    height: 100%;
  }

  .quick-actions .card-header {
    background: white;
    border-bottom: 1px solid var(--light-gray);
    padding: 1.25rem 1.5rem;
    border-radius: var(--border-radius) var(--border-radius) 0 0 !important;
  }

  .quick-actions .card-body {
    padding: 1.5rem;
  }

  .quick-actions .btn {
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 0.875rem 1.25rem;
    border-radius: 0.5rem;
    font-weight: 500;
    transition: var(--transition);
    border: 1px solid var(--gray-light);
    background: white;
    color: var(--dark);
    width: 100%;
    text-align: left;
  }

  .quick-actions .btn i {
    margin-right: 0.75rem;
    font-size: 1.1rem;
    width: 1.25rem;
    text-align: center;
  }

  .quick-actions .btn:hover {
    transform: translateX(5px);
    border-color: var(--primary);
    color: var(--primary);
    background: var(--primary-light);
  }

  /* Recent Activity */
  .recent-activity {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    height: 100%;
  }

  .recent-activity .card-header {
    background: white;
    border-bottom: 1px solid var(--light-gray);
    padding: 1.25rem 1.5rem;
    border-radius: var(--border-radius) var(--border-radius) 0 0 !important;
  }

  .recent-activity .card-body {
    padding: 1.5rem;
  }

  .activity-item {
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid var(--gray-light);
    display: flex;
    align-items: flex-start;
    transition: var(--transition);
  }

  .activity-item:last-child {
    border-bottom: none;
  }

  .activity-item:hover {
    background-color: rgba(0, 0, 0, 0.02);
  }

  .activity-icon {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 0.5rem;
    background-color: var(--primary-light);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    color: var(--primary);
    flex-shrink: 0;
    font-size: 1.1rem;
  }

  .activity-icon.success { background: rgba(40, 167, 69, 0.1); color: var(--success); }
  .activity-icon.warning { background: rgba(255, 193, 7, 0.1); color: var(--warning); }
  .activity-icon.danger { background: rgba(220, 53, 69, 0.1); color: var(--danger); }

  .activity-content h6 {
    margin: 0 0 0.25rem;
    font-weight: 600;
    font-size: 0.9375rem;
    color: var(--dark);
  }

  .activity-content p {
    margin: 0;
    color: var(--gray);
    font-size: 0.875rem;
    line-height: 1.5;
  }

  .activity-time {
    font-size: 0.75rem;
    color: var(--gray);
    display: flex;
    align-items: center;
    margin-top: 0.25rem;
  }

  .activity-time i {
    font-size: 0.7rem;
  }

  /* Charts */
  .chart-container {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    height: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .chart-header {
    padding: 1.5rem 1.5rem 0.5rem;
    border-bottom: 1px solid var(--gray-light);
  }

  .chart-body {
    padding: 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  #performanceChart, #subjectDistributionChart {
    flex: 1;
    min-height: 250px;
  }

  /* Section Titles */
  .section-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .section-title i {
    color: var(--primary);
    font-size: 1.25rem;
    width: 24px;
    height: 24px;
    border-radius: 6px;
    background: var(--primary-light);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Responsive Adjustments */
  @media (max-width: 992px) {
    .welcome-section {
      text-align: center;
    }

    .welcome-section::before {
      display: none;
    }

    .stat-card {
      text-align: left;
      padding: 1.25rem;
    }

    .stat-card .icon-wrapper {
      margin: 0 0 1rem;
      margin: 0 auto 1.25rem;
    }

    .stat-card::before {
      width: 100%;
      height: 4px;
      top: 0;
      left: 0;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="welcome-section">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-8">
        <h1 class="display-5 fw-bold mb-3">Welcome back, {{ username }}! ðŸ‘‹</h1>
        <p class="lead mb-0">Here's what's happening with your students today. Track performance, analyze data, and make informed decisions.</p>
      </div>
      <div class="col-lg-4 text-lg-end mt-4 mt-lg-0">
        <div class="d-inline-flex align-items-center bg-white-10 p-2 px-3 rounded-pill">
          <i class="far fa-clock me-2"></i>
          <span id="currentTime" class="fw-medium"></span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row g-4 mb-4">
  <!-- Students Card -->
  <div class="col-md-6 col-xl-3">
    <div class="stat-card students">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div class="icon">
          <i class="fas fa-user-graduate"></i>
        </div>
        <span class="badge bg-success bg-opacity-10 text-success">+12%</span>
      </div>
      <div class="value">1,248</div>
      <div class="label">Total Students</div>
      <div class="progress">
        <div class="progress-bar" role="progressbar" style="width: 75%; background-color: var(--primary);" 
             aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <div class="d-flex justify-content-between mt-2">
        <small class="text-muted">Last month: 1,115</small>
        <small class="fw-bold" style="color: var(--primary);">75%</small>
      </div>
    </div>
  </div>
  
  <!-- Average Score Card -->
  <div class="col-md-6 col-xl-3">
    <div class="stat-card scores">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div class="icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <span class="badge bg-success bg-opacity-10 text-success">+2.5%</span>
      </div>
      <div class="value">84.5%</div>
      <div class="label">Average Score</div>
      <div class="progress">
        <div class="progress-bar" role="progressbar" style="width: 84.5%; background-color: var(--secondary);" 
             aria-valuenow="84.5" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <div class="d-flex justify-content-between mt-2">
        <small class="text-muted">Last term: 82.0%</small>
        <small class="fw-bold" style="color: var(--secondary);">84.5%</small>
      </div>
    </div>
  </div>
  
  <!-- Subjects Card -->
  <div class="col-md-6 col-xl-3">
    <div class="stat-card subjects">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div class="icon">
          <i class="fas fa-book-open"></i>
        </div>
        <span class="badge bg-warning bg-opacity-10 text-warning">+3 new</span>
      </div>
      <div class="value">12</div>
      <div class="label">Active Subjects</div>
      <div class="progress">
        <div class="progress-bar" role="progressbar" style="width: 60%; background-color: var(--warning);" 
             aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <div class="d-flex justify-content-between mt-2">
        <small class="text-muted">This semester</small>
        <small class="fw-bold" style="color: var(--warning);">60%</small>
      </div>
    </div>
  </div>
  
  <!-- Performance Card -->
  <div class="col-md-6 col-xl-3">
    <div class="stat-card performance">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div class="icon">
          <i class="fas fa-trophy"></i>
        </div>
        <span class="badge bg-danger bg-opacity-10 text-danger">+5%</span>
      </div>
      <div class="value">92%</div>
      <div class="label">Pass Rate</div>
      <div class="progress">
        <div class="progress-bar" role="progressbar" style="width: 92%; background-color: var(--danger);" 
             aria-valuenow="92" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <div class="d-flex justify-content-between mt-2">
        <small class="text-muted">Last year: 87%</small>
        <small class="fw-bold" style="color: var(--danger);">92%</small>
      </div>
    </div>
  </div>
</div>

<div class="row g-4 mb-4">
  <!-- Performance Chart -->
  <div class="col-lg-8">
    <div class="chart-container">
      <div class="chart-header">
        <h5 class="section-title"><i class="fas fa-chart-bar"></i> Performance Overview</h5>
      </div>
      <div class="chart-body">
        <div id="performanceChart"></div>
      </div>
    </div>
  </div>
  
  <!-- Quick Actions -->
  <div class="col-lg-4">
    <div class="quick-actions card h-100">
      <div class="card-header">
        <h5 class="section-title mb-0"><i class="fas fa-bolt"></i> Quick Actions</h5>
      </div>
      <div class="card-body">
        <a href="{{ url_for('student_bp.add_student') }}" class="btn">
          <i class="fas fa-user-plus"></i> Add New Student
        </a>
        <a href="{{ url_for('score_bp.add_score') }}" class="btn">
          <i class="fas fa-plus-circle"></i> Record Score
        </a>
        <a href="{{ url_for('subject_bp.list_subjects') }}" class="btn">
          <i class="fas fa-book"></i> Manage Subjects
        </a>
        <a href="{{ url_for('analysis_bp.analysis_index') }}" class="btn">
          <i class="fas fa-chart-pie"></i> View Reports
        </a>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Recent Activities -->
  <div class="col-12">
    <div class="recent-activity card h-100">
      <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="section-title mb-0"><i class="fas fa-history"></i> Recent Activities</h5>
          <a href="#" class="btn btn-sm btn-outline-primary">View All</a>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="activity-item">
          <div class="activity-icon">
            <i class="fas fa-user-edit"></i>
          </div>
          <div class="activity-content">
            <h6 class="mb-1">Student Record Updated</h6>
            <p class="mb-1">John Doe's information was updated by Admin</p>
            <span class="activity-time">10 minutes ago</span>
          </div>
        </div>
        <div class="activity-item">
          <div class="activity-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="activity-content">
            <h6 class="mb-1">New Score Recorded</h6>
            <p class="mb-1">Mathematics score added for Sarah Johnson</p>
            <span class="activity-time">2 hours ago</span>
          </div>
        </div>
        <div class="activity-item">
          <div class="activity-icon">
            <i class="fas fa-user-graduate"></i>
          </div>
          <div class="activity-content">
            <h6 class="mb-1">New Student Registered</h6>
            <p class="mb-1">Michael Brown joined the system</p>
            <span class="activity-time">Yesterday</span>
          </div>
        </div>
        <div class="activity-item">
          <div class="activity-icon">
            <i class="fas fa-file-export"></i>
          </div>
          <div class="activity-content">
            <h6 class="mb-1">Report Generated</h6>
            <p class="mb-1">Class 10A performance report was exported</p>
            <span class="activity-time">2 days ago</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
  // Update current time
  function updateCurrentTime() {
    const now = new Date();
    const options = { 
      weekday: 'long', 
      year: 'numeric', 
      month: 'short', 
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    };
    document.getElementById('currentTime').textContent = now.toLocaleDateString('en-US', options);
  }
  
  // Update time immediately and then every minute
  updateCurrentTime();
  setInterval(updateCurrentTime, 60000);
  
  // Initialize Performance Chart
  document.addEventListener('DOMContentLoaded', function() {
    // Performance Chart
    var performanceOptions = {
      series: [{
        name: 'Average Score',
        data: [65, 72, 68, 73, 78, 82, 85, 88, 86, 84, 87, 90]
      }],
      chart: {
        height: '100%',
        type: 'area',
        toolbar: {
          show: false
        },
        zoom: {
          enabled: false
        },
        fontFamily: 'Inter, sans-serif'
      },
      colors: ['#5e72e4'],
      dataLabels: {
        enabled: false
      },
      stroke: {
        curve: 'smooth',
        width: 2
      },
      fill: {
        type: 'gradient',
        gradient: {
          shadeIntensity: 1,
          opacityFrom: 0.7,
          opacityTo: 0.1,
          stops: [0, 90, 100]
        }
      },
      xaxis: {
        categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        axisBorder: {
          show: false
        },
        axisTicks: {
          show: false
        },
        labels: {
          style: {
            colors: '#8898aa',
            fontSize: '12px',
            fontFamily: 'Inter, sans-serif'
          }
        }
      },
      yaxis: {
        labels: {
          style: {
            colors: '#8898aa',
            fontSize: '12px',
            fontFamily: 'Inter, sans-serif'
          },
          formatter: function(value) {
            return value + '%';
          }
        }
      },
      grid: {
        borderColor: '#f1f4f8',
        strokeDashArray: 5,
        yaxis: {
          lines: {
            show: true
          }
        },
        xaxis: {
          lines: {
            show: false
          }
        }
      },
      tooltip: {
        y: {
          formatter: function(value) {
            return value + '%';
          }
        }
      }
    };

    var performanceChart = new ApexCharts(document.querySelector("#performanceChart"), performanceOptions);
    performanceChart.render();

    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
  });
</script>
{% endblock %}
